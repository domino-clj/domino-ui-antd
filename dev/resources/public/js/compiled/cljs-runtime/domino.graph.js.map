{"version":3,"sources":["domino/graph.cljc"],"mappings":"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","names":["domino.graph/conj-set","cljs.core.fnil.cljs$core$IFn$_invoke$arity$2","cljs.core/conj","domino.graph/into-set","cljs.core/into","domino.graph/find-related","input-node","events","cljs.core.keep.cljs$core$IFn$_invoke$arity$2","p__37409","map__37410","cljs.core/PROTOCOL_SENTINEL","cljs.core.apply.cljs$core$IFn$_invoke$arity$2","cljs.core/hash-map","cljs.core.get.cljs$core$IFn$_invoke$arity$2","inputs","outputs","cljs.core/some","p1__37408#","cljs.core.remove.cljs$core$IFn$_invoke$arity$2","cljs.core._EQ_.cljs$core$IFn$_invoke$arity$2","cljs.core/concat","domino.graph/add-nodes","ctx","cljs.core.reduce.cljs$core$IFn$_invoke$arity$3","p__37413","vec__37414","map__37417","cljs.core.nth.cljs$core$IFn$_invoke$arity$3","nodes","input","related","cljs.core.update.cljs$core$IFn$_invoke$arity$4","cljs.core.update.cljs$core$IFn$_invoke$arity$6","cljs.core/update","cljs.core.into.cljs$core$IFn$_invoke$arity$2","domino.graph/base-graph-ctx","domino.graph/input-nodes","cljs.core.distinct.cljs$core$IFn$_invoke$arity$1","cljs.core.mapcat.cljs$core$IFn$_invoke$arity$variadic","domino.graph/gen-graph","p__37425","map__37426","g","i","o","cljs.core.merge_with.cljs$core$IFn$_invoke$arity$variadic","clojure.set/union","cljs.core/zipmap","cljs.core.repeat.cljs$core$IFn$_invoke$arity$1","cljs.core/set","domino.graph/reverse-edge-direction","graph","cljs.core/reduce-kv","inverted","p__37434","map__37435","domino.graph/validate-event","handler","ev","errors","temp__5718__auto__","event-errors","cljs.core/not-empty","G__37437","cljs.core/empty?","cljs.core.conj.cljs$core$IFn$_invoke$arity$2","cljs.core/fn?","cljs.core.assoc.cljs$core$IFn$_invoke$arity$3","domino.graph/gen-ev-graph","vec__37438","p__37441","p__37442","vec__37443","map__37446","h","cljs.core.ex_info.cljs$core$IFn$_invoke$arity$2","domino.graph/traversed-edges","origin","edge-filter","edges","cljs.core.filter.cljs$core$IFn$_invoke$arity$2","cljs.core.get.cljs$core$IFn$_invoke$arity$3","related-nodes","cljs.core.partial.cljs$core$IFn$_invoke$arity$2","cljs.core/contains?","cljs.core.disj.cljs$core$IFn$_invoke$arity$2","cljs.core.map.cljs$core$IFn$_invoke$arity$2","cljs.core.apply.cljs$core$IFn$_invoke$arity$3","p1__37448#","G__37449","G__37450","G__37451","cljs.core.dissoc.cljs$core$IFn$_invoke$arity$2","domino.graph/connected-nodes-map","cljs.core/keys","p1__37452#","cljs.core.juxt.cljs$core$IFn$_invoke$arity$2","cljs.core/identity","domino.graph/subgraphs","cljs.core/constantly","cljs.core/vals","p1__37453#","cljs.core/select-keys","domino.graph/get-db-paths","model","db","paths","id->value","path","domino.model/id-for-path","cljs.core.get_in.cljs$core$IFn$_invoke$arity$2","domino.graph/empty-queue","cljs.core/PersistentQueue","p__37454","p__37455","map__37456","map__37457","domino.graph/try-event","event","old-outputs","e37460","or__4131__auto__","G__37465","G__37466","G__37467","js/Error","e","cljs.core.ex_info.cljs$core$IFn$_invoke$arity$3","p__37468","map__37469","domino.graph/ctx-updater","executed-events","p__37471","map__37472","map__37473","new-outputs","id","new-value","cljs.core.not_EQ_.cljs$core$IFn$_invoke$arity$2","cljs.core/reduce","domino.util/generate-sub-paths","cljs.core.update.cljs$core$IFn$_invoke$arity$5","cljs.core/assoc-in","domino.graph/input?","edge","domino.graph/origin-path","cljs.core/vec","cljs.core.subvec.cljs$core$IFn$_invoke$arity$3","cljs.core/count","var_args","G__37477","domino.graph/eval-traversed-edges","p__37478","map__37479","p__37481","map__37482","changed-paths","x","cljs.core/peek","xs","cljs.core/pop","domino.graph.eval_traversed_edges.cljs$core$IFn$_invoke$arity$3","changes","map__37484","focal-origin","removed-origin","new-ctx","p__37486","map__37487","domino.graph/execute-events","map__37489","domino.graph.eval_traversed_edges.cljs$core$IFn$_invoke$arity$2","p__37493","vec__37494","value","cljs.core.assoc.cljs$core$IFn$_invoke$arity$variadic","p__37498","map__37499","domino.graph/events-inputs-as-changes","events-by-id","event-ids","event-id","cljs.core.concat.cljs$core$IFn$_invoke$arity$2"],"sourcesContent":["(ns domino.graph\n  (:require\n    [domino.model :as model]\n    [domino.util :refer [generate-sub-paths]]\n    [clojure.set :refer [union]]))\n\n(def conj-set (fnil conj #{}))\n\n(def into-set (fnil into #{}))\n\n(defn find-related\n  \"finds other nodes related by eventset\"\n  [input-node events]\n  (->> events\n       (keep (fn [{:keys [inputs outputs]}]\n               (when (some #{input-node} outputs)\n                 (remove #(= input-node %) inputs))))\n       (apply concat)))\n\n(defn add-nodes\n  [ctx inputs]\n  (reduce\n    (fn [[{:keys [nodes] :as ctx} inputs] input]\n      (let [related (find-related input nodes)]\n        [(-> ctx\n             (update :visited conj-set input)\n             (update :graph update input into-set related))\n         (into inputs related)]))\n    [ctx #{}]\n    inputs))\n\n(defn base-graph-ctx\n  [nodes]\n  {:nodes nodes\n   :graph {}})\n\n(defn input-nodes\n  [events]\n  (distinct (mapcat :inputs events)))\n\n(defn gen-graph\n  [events]\n  (reduce\n    (fn [g {i :inputs o :outputs}]\n      (merge-with\n        union\n        g\n        (zipmap i (repeat (set o)))))\n    {}\n    events))\n\n(defn reverse-edge-direction\n  [graph]\n  (reduce-kv\n    (fn [inverted i o]\n      (merge-with\n        union\n        inverted\n        (zipmap o (repeat #{i}))))\n    {}\n    graph))\n\n(defn validate-event [{:keys [outputs handler] :as ev} errors]\n  (if-let [event-errors (not-empty\n                          (cond-> []\n                                  (empty? outputs) (conj \"event :outputs must contain at least one target\")\n                                  (not (fn? handler)) (conj \"event :handler must be a function\")))]\n    (assoc errors ev event-errors)\n    errors))\n\n(defn gen-ev-graph\n  [events]\n  (let [[graph errors]\n        (reduce\n          (fn [[g errors] {i :inputs o :outputs h :handler :as ev}]\n            [(merge-with\n               union\n               g\n               (zipmap i (repeat #{{:edge ev :relationship :input :connections (set o)}}))\n               (zipmap o (repeat #{{:edge ev :relationship :output :connections (set i)}})))\n             (validate-event ev errors)])\n          [{} {}]\n          events)]\n    (if-not (empty? errors)\n      (throw (ex-info\n               \"graph contains invalid events\"\n               {:errors errors}))\n      graph)))\n\n(defn traversed-edges [origin graph edge-filter]\n  (let [edges         (filter edge-filter (get graph origin #{}))\n        related-nodes (filter\n                        (partial contains? graph)\n                        (disj\n                          (reduce\n                            union\n                            #{}\n                            (map :connections edges))\n                          origin))]\n    (apply union\n           (set edges)\n           (map\n             #(traversed-edges\n                %\n                (dissoc graph origin)\n                edge-filter)\n             related-nodes))))\n\n(defn connected-nodes-map [graph edge-filter]\n  (->> graph\n       keys\n       (map\n         (juxt identity\n               #(->> (traversed-edges % graph edge-filter)\n                     (map :connections)\n                     (apply union))))\n       (into {})))\n\n(defn subgraphs [graph]\n  (->> (connected-nodes-map graph (constantly true))\n       vals\n       distinct\n       (remove empty?)\n       (map #(select-keys graph %))))\n\n\n;;;\n(defn get-db-paths [model db paths]\n  (reduce\n    (fn [id->value path]\n      (assoc id->value (model/id-for-path model path) (get-in db path)))\n    {}\n    paths))\n\n(def empty-queue\n  #?(:clj  clojure.lang.PersistentQueue/EMPTY\n     :cljs cljs.core/PersistentQueue.EMPTY))\n\n#?(:clj\n   (defmethod clojure.core/print-method clojure.lang.PersistentQueue\n     [queue writer]\n     (.write writer (str \"#<PersistentQueue: \" (pr-str (vec queue)) \">\"))))\n\n(defn try-event [{:keys [handler inputs] :as event} {:domino.core/keys [model] :as ctx} db old-outputs]\n  (try\n    (or\n      (handler ctx (get-db-paths model db inputs) old-outputs)\n      old-outputs)\n    (catch #?(:clj Exception :cljs js/Error) e\n      (throw (ex-info \"failed to execute event\" {:event event :context ctx :db db} e)))))\n\n(defn ctx-updater\n  \"Reducer that updates context with new values updated in ctx from\n  handler of each edge. New values are only stored when they are different\n  from old values.\n\n  In changed cases, the following keys are updated:\n  ::changed-paths => queue of affected paths\n  ::db => temporary relevant db within context\n  ::change-history => sequential history of changes. List of tuples of path-value pairs\"\n  [edges {::keys [db executed-events] :domino.core/keys [model] :as ctx}]\n  (reduce\n    (fn [ctx {{:keys [outputs] :as event} :edge}]\n      (if (contains? executed-events event)\n        ctx\n        (let [ctx         (update ctx ::executed-events conj event)\n              old-outputs (get-db-paths (:domino.core/model ctx) db outputs)\n              new-outputs (try-event event ctx db old-outputs)]\n          (reduce-kv\n            (fn [ctx id new-value]\n              ;;todo validate that the id matches an ide declared in outputs\n              (if (not= (get old-outputs id) new-value)\n                (let [path (get-in model [:id->path id])]\n                  (-> ctx\n                      (update ::changed-paths (fnil (partial reduce conj) empty-queue)\n                              (generate-sub-paths path))\n                      (update ::db assoc-in path new-value)\n                      (update ::changes conj [path new-value])))\n                ctx))\n            ctx\n            new-outputs))))\n    ctx\n    edges))\n\n(defn input? [edge]\n  (= :input (:relationship edge)))\n\n(defn origin-path [graph origin]\n  (loop [origin (vec origin)]\n    (or (when (empty? origin) ::does-not-exist)\n        (when (contains? graph origin) origin)\n        (recur (subvec origin 0 (dec (count origin)))))))\n\n(defn eval-traversed-edges\n  \"Given an origin and graph, update context with edges.\n\n  When an node has been visited (as an input), it cannot be considered for an output\"\n  ([{::keys [changed-paths] :as ctx} graph]\n   (let [x  (peek changed-paths)\n         xs (pop changed-paths)]\n     (eval-traversed-edges (assoc ctx ::changed-paths xs) graph x)))\n  ([{::keys [changes] :as ctx} graph origin]\n   (let [focal-origin   (origin-path graph origin)\n         edges          (filter input? (get graph focal-origin #{}))\n         removed-origin (dissoc graph focal-origin)\n         {::keys [changed-paths] :as new-ctx} (ctx-updater edges ctx)\n         x              (peek changed-paths)\n         xs             (pop changed-paths)]\n     (if x\n       (recur (assoc new-ctx ::changed-paths xs) removed-origin x)\n       new-ctx))))\n\n(defn execute-events [{:domino.core/keys [db graph] :as ctx} inputs]\n  (let [{::keys [db changes]} (eval-traversed-edges\n                                (reduce\n                                  (fn [ctx [path value]]\n                                    (-> ctx\n                                        (update ::db assoc-in path value)\n                                        (update ::changed-paths conj path)\n                                        (update ::changes conj [path value])))\n                                  (assoc ctx ::db db\n                                             ::changed-paths empty-queue\n                                             ::executed-events #{}\n                                             ::changes [])\n                                  inputs)\n                                graph)]\n    (assoc ctx :domino.core/db db\n               :change-history changes)))\n\n(defn events-inputs-as-changes [{:domino.core/keys [events-by-id db]} event-ids]\n  (reduce\n    (fn [changes event-id]\n      (let [inputs (get-in events-by-id [event-id :inputs])]\n        (concat changes\n                (map (fn [path]\n                       [path (get-in db path)])\n                     inputs))))\n    []\n    event-ids))\n"]}